package display.shooter{//creating the basic skeleton	import display.bullet.Bullet;	import display.bullet.Ice;	import display.bullet.Rock;	import display.enemy.Enemy;		import flash.display.MovieClip;	import flash.events.Event;	import flash.events.MouseEvent;

	public class Shooter extends MovieClip{				public var cost:Number = 20;//how much cost to buy				protected var _root:TowerDefense;				protected var damage:int = 3;//how much damage this little baby can inflict		protected var range:int = 100;//how far away (in pixels) it can hit a target		protected var enTarget:Enemy;//the current target that it's rotating towards		protected var cTime:int = 0;//how much time since a shot was fired by this turret		protected var reloadTime:int = 12;//how long it takes to fire another shot		protected var loaded:Boolean = true;//whether or not this turret can shoot		protected var upgradeFactor:Number = 1.2;//increases range, cost, bulletSpeed and damage when upgrade		protected var upgradeCount:int = 0;//how many times it was upgraded 		protected var bulletSpeed:Number = 1;//how fast the bullet goes				public function Shooter(root:TowerDefense){			_root = root;						//adding the required listeners			this.addEventListener(Event.ADDED, beginClass);			this.addEventListener(Event.ENTER_FRAME, update);			this.addEventListener(MouseEvent.CLICK, upgrade);			this.addEventListener(MouseEvent.MOUSE_OVER, thisMouseOver);			this.addEventListener(MouseEvent.MOUSE_OUT, thisMouseOut);		}				protected function beginClass(e:Event):void{			this.removeEventListener(Event.ADDED, beginClass);		}				public function disable():void		{			this.removeEventListener(Event.ENTER_FRAME, update);			this.removeEventListener(MouseEvent.CLICK, upgrade);			this.removeEventListener(MouseEvent.MOUSE_OVER, thisMouseOver);			this.removeEventListener(MouseEvent.MOUSE_OUT, thisMouseOut);		}				protected function update(e:Event):void{			//FINDING THE NEAREST ENEMY WITHIN RANGE			var distance:Number = range;//let's define a variable which will be how far the nearest enemy is			var cEnemy:Enemy;////define a movieclip that will hold the current child			enTarget = null;//right now, we don't have a target to shoot at			for(var i:uint=0; i < _root.game.enemyHolder.numChildren && enTarget==null;i++){//loop through the children in enemyHolder				cEnemy = _root.game.enemyHolder.getChildAt(i) as Enemy;				//this simple formula with get us the distance of the current enemy				if(Math.sqrt(Math.pow(cEnemy.y - y, 2) + Math.pow(cEnemy.x - x, 2)) < distance){					//if the selected enemy is close enough, then set it as the target					enTarget = cEnemy;				}			}			//ROTATING TOWARDS TARGET			if(enTarget != null){//if we have a defined target				this.rotation = Math.atan2((enTarget.y+_root.gridScaleHalf-y), enTarget.x+_root.gridScaleHalf-x)/Math.PI*180 - 90;				shoot();			}			//LOADING THE TURRET			if(!loaded){//if it isn't loaded				cTime ++;//then continue the time				if(cTime == reloadTime){//if time has elapsed for long enough					loaded = true;//load the turret					cTime = 0;//and reset the time				}			}			if(_root.game.isOver){//destroy this if game is over				this.removeEventListener(Event.ENTER_FRAME, update);				if(this.parent.contains(this)) this.parent.removeChild(this);			}		}				public function upgrade(e:MouseEvent):void		{			if(_root.game.money >= cost * upgradeFactor && upgradeCount<3) {				upgradeCount++;								range *= upgradeFactor;				cost *= upgradeFactor;				damage *= upgradeFactor;				bulletSpeed *= upgradeFactor;								if(this is Freezer) {					Freezer(this).iceFactor /= upgradeFactor;				}else if(this is Catapult) {					Catapult(this).spread *= upgradeFactor;				}								_root.game.rangeCircle.width = _root.game.rangeCircle.height = range * 2;								_root.game.money -= cost;			}		}				protected function thisMouseOver(e:MouseEvent):void{			_root.game.rangeCircle.width = _root.game.rangeCircle.height = range * 2;			_root.game.rangeCircle.x = this.x-_root.gridScaleHalf;			_root.game.rangeCircle.y = this.y-_root.gridScaleHalf;			_root.game.addChild(_root.game.rangeCircle);		}				protected function thisMouseOut(e:MouseEvent):void{			_root.game.rangeCircle.width = _root.game.rangeCircle.height = 200;			_root.game.removeChild(_root.game.rangeCircle);		}				public function shoot():void{			if(loaded){//if the turret is able to shoot				loaded = false;//then make in unable to do it for a bit				var newBullet:Bullet;//create a bullet				if(this is Freezer){					newBullet = new Ice(_root, Freezer(this).iceFactor);					}else if(this is Catapult){					newBullet = new Rock(_root, Catapult(this).spread);					}else{					newBullet = new Bullet(_root);				}								//set the bullet's coordinates				newBullet.x = this.x;				newBullet.y = this.y;				//set the bullet's target and damage				newBullet.target = enTarget;				newBullet.damage = damage;				newBullet.maxDistance = range;				newBullet.maxSpeed *= bulletSpeed;				_root.addChild(newBullet);//add it to the stage			}			}	}}